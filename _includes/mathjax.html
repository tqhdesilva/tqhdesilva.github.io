{% if page.mathjax %}
<!-- https://stackoverflow.com/a/74941152 -->
<script>
  MathJax = {
    removeCode(math, doc) {
      const code = math.start.node.parentNode;
      if (code.nodeName === 'CODE' && code.childNodes.length === 1) {
        const span = document.createElement('mjx-span');
        code.parentNode.replaceChild(span, code);
        span.appendChild(code.firstChild);
      }
    },
    options: {
      skipHtmlTags: { '[-]': ['code', 'pre'] },
      renderActions: {
        removeCode: [
          11,
          (doc) => { for (const math of MathJax.startup.document.math) MathJax.config.removeCode(math, doc) },
          (math, doc) => MathJax.config.removeCode(math, doc),
          false
        ]
      }
    },
    tex: {
      inlineMath: [['$', '$'], ['`$', '$`'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['`$$', '$$`'], ['\\[', '\\]']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer id="MathJax-script"></script>

{% endif %}